<html>
	<head>
		<link rel="stylesheet" href="bootstrap-4.4.1-dist\css\bootstrap.min.css">
	</head>
	
	<body>
		<div class="container mt-3 " >
			<div class="row ">
				<div class="col-4" >
					<div class="row alert alert-primary justify-content-center" "role="alert" style="margin-bottom: 0rem;">
						Circuit
					</div>
					
					<div class="row h-75">
						<textarea class="form-control" id="circuit" placeholder="Input your circuit" required></textarea>
					</div>
				</div>
				
				<div class="col mr-2 ">
					<table class="table text-center " role="alert">
						<thead class="table-danger" >
							<tr>
								<th scope="col"> Input </th>
								<th scope="col"> Image </th>
								<th scope="col">Description </th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<th scope="col">0</th>
								<th><img src="image\cb0.png"></th>
								<th scope="col">Control bit (low level trigger)</th>
							</tr>
							
							<tr>
								<th scope="col">1</th>
								<th><img src="image\cb1.png"></th>
								<th scope="col">Control bit (high level trigger)</th>
							</tr>
							
							<tr>
								<th scope="col">2</th>
								<th><img src="image\cpb.png"></th>
								<th scope="col">Wire gate</th>
							</tr>
							
							<tr>
								<th scope="col">3</th>
								<th><img src="image\nb.png"></th>
								<th scope="col">NOT-gate
									Note that each line must contain exactly one NOT-gate.</th>
							</tr>
						</tbody>
					</table>
					
				</div>
				
			</div>
			
			<div class="row mt-2" style="text-align:center">
				<div class="col-4 mr-3">
					<button class="btn btn-primary" onclick="run(true)">Decimal</button>
					<button class="btn btn-primary" onclick="run(false)">Binary</button>
					<button class="btn btn-danger" onclick="reset(true)">Clear</button>
				</div>
				
				
				<div class="col mr-3"  style="border:1px solid transparent; border-radius:0.25rem; margin-bottom: 1rem; color: #818182; background-color: #fefefe; border-color: #fdfdfe; padding: 0.4rem;">
					<p id="gate_count">Gate count ：  </p>
				</div>
				
			</div >
			
			<div class="row mt-1 text-center">
				<div class="col-4 mr-3">
					<div class="row alert alert-warning justify-content-center" "role="alert" style="margin-bottom: 0rem;">
						Truth table
					</div>
					
					<div class="row">
						<textarea id="truth_table" name="truthTable" rows="17" cols="40" readonly="" style="font-family:Consolas,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,
                          Bitstream Vera Sans Mono,Courier New, monospace"></textarea>
					</div>
				</div>
				
				<div class="col mr-3 text-center" style="overflow: scroll;" id="canvasFrame">
					<div class="row alert alert-success justify-content-center" "role="alert" style="margin-bottom: 0rem;">
						Circuit diagram
					</div>
					
					<div class="row text-center"  >
						<svg id="svg_diagram" width="0px" height="0px" style="background:#FFFFFF;">
							
						</svg>
					</div>
					
				</div>
				
			</div>

			
		</div>
	</body>

	<script>
	
		function run(e){
		
			var gate_number=0;
			var bit_number=0;
			var bit_gate = document.getElementById("circuit").value.split(' ');
	
			gate_number = bit_gate.length;
			if (gate_number != 0){
				bit_number = bit_gate[0].length;
			}
			if (bit_gate[gate_number-1] == ''){
				gate_number-=1;
			}
			
			
			var bit_gate2 = new Array(gate_number);

			for (var i = 0; i < gate_number; i++) {
				bit_gate2[i] = new Array(bit_number);
				for(var j=0;j<bit_number;j++){
					bit_gate2[i][j] = bit_gate[i][j] - '0';
				}
			}
			
			var aa = document.getElementById("gate_count");
			aa.innerHTML = "Gate count ： "+gate_number;
			
			var bb = document.getElementById("truth_table");
			
			bb.value = "";
			var k=0;
			
			var number = new Array(bit_number);
			
			for( var i=0;i<Math.pow(2,bit_number);i++){
			
				k=i;
				
				for(var j=0;j<bit_number;j++){
					number[j] = 0
					number[j] = k % 2;
					k = parseInt(k/2);			
				}
				
				if ( e == true){
					bb.value +=" ";
					bb.value += i;
				}
				
				else{
					for(var j=bit_number-1 ;j>=0;j--){
						
						bb.value +=" ";
						bb.value += number[j];
					}
				}
				
				bb.value += " ->" ;
				
				
				for(var j=0;j<gate_number;j++){
					k=0;
					for(var x=0;x<bit_number;x++){
						if (number[bit_number-x-1]==1 && bit_gate2[j][x] == 0 ||  number[bit_number-x-1]==0 && bit_gate2[j][x] == 1){
							k=1;
						}
					}
					
					for(var x=0;x<bit_number;x++){
						//cout << number[0] <<" " << number[1] <<" " << number[2] << " ---> ";
						if (bit_gate2[j][x] == 3 && k==0 ){
							if(number[bit_number-x-1] == 1 ){
								number[bit_number-x-1] = 0;
							}
							else{
								number[bit_number-x-1] = 1;
							}
							
						}
						//cout << number[0] <<" " << number[1] <<" " << number[2] << endl;
					}
				}
				if (e==true){
					var answer = 0;
					for(var j=bit_number-1 ;j>=0;j--){
						answer += number[j] * Math.pow(2,j);
					}
					bb.value +=" ";
					bb.value += answer;
				}
				else{
					for(var j=bit_number-1 ;j>=0;j--){
						bb.value +=" ";
						bb.value += number[j];
					}
				}
				
				bb.value += '\n';
			}
			
			//正中間350
			
			var w = 60;
			var h = 50;
			var c = document.getElementById("svg_diagram");
			c.style.height = "390px";
			c.style.width = "1000px";
			
			/*for(var x=0;x<gate_number;x++){
				
				var newpath = document.createElementNS("http://www.w3.org/2000/svg", 'path'); //Create a path in SVG's namespace
				var d = "M " + (300-w*gate_number/2+30+w*x) + " " + (50) +" L " + (300-w*gate_number/2+30+w*x) +" " + (50+(bit_number-1)*h) ;
				newpath.setAttribute("d",d); //Set path's data
				newpath.style.stroke = "#000"; //Set stroke colour
				newpath.style.strokeWidth = "2px"; //Set stroke widthv
				c.appendChild(newpath);
				
			}*/
			
			var b = 0;
			var p = 0;
			var m = 0;
			var mn = 0;
			for (var j=0;j<bit_number;j++){
				var newpath = document.createElementNS("http://www.w3.org/2000/svg", 'path'); //Create a path in SVG's namespace
				var d = "M " + (350-w*gate_number/2) + " " + (50+j*h) +" L " + (350+w*gate_number/2) +" " + (50+j*h) ;
				newpath.setAttribute("d",d); //Set path's data
				newpath.style.stroke = "#000"; //Set stroke colour
				newpath.style.strokeWidth = "2px"; //Set stroke widthv
				c.appendChild(newpath);

				for(var x=0;x<gate_number;x++){
					
					if (j==0){
						m=0;
						p=0;
						b=0;
						mn = 0;
						if (bit_gate2[x][0] == 2){
							m=1;
						}
						else if(bit_gate2[x][0] == 3){
							b=1;
							mn=1;
						}
						
						for(var n=1;n<bit_number;n++){
							if(bit_gate2[x][n] == 3){
								b=1;
								mn = 1;
							}
							if (bit_gate2[x][n] != 2){
								mn = 1;
								p = n;
								
							}
							else if (mn == 0 && m > 0){		
								m++;
							}
						}
						
						if (b==1){
							var newpath = document.createElementNS("http://www.w3.org/2000/svg", 'path'); //Create a path in SVG's namespace
							var d = "M " + (350-w*gate_number/2+30+w*x) + " " + (50+m*h) +" L " + (350-w*gate_number/2+30+w*x) +" " + (50+p*h) ;
							newpath.setAttribute("d",d); //Set path's data
							newpath.style.stroke = "#000"; //Set stroke colour
							newpath.style.strokeWidth = "2px"; //Set stroke widthv
							c.appendChild(newpath);
						}
					}
					
					if(bit_gate2[x][j] == 0){
						
						var newcircle = document.createElementNS("http://www.w3.org/2000/svg", 'circle'); 
						newcircle.setAttributeNS(null, 'cx', 350-w*gate_number/2+30+w*x);
						newcircle.setAttributeNS(null, 'cy', 50+j*h);
						newcircle.setAttributeNS(null, 'r', 8);
						newcircle.setAttributeNS(null, 'style', 'fill:white; stroke: black; stroke-width: 2px;' );
						c.appendChild(newcircle);
					}
					else if(bit_gate2[x][j] == 1){
						
						
					
						var newcircle = document.createElementNS("http://www.w3.org/2000/svg", 'circle'); 
						newcircle.setAttributeNS(null, 'cx', 350-w*gate_number/2+30+w*x);
						newcircle.setAttributeNS(null, 'cy', 50+j*h);
						newcircle.setAttributeNS(null, 'r', 8);
						newcircle.setAttributeNS(null, 'style', ' stroke: black; stroke-width: 2px;' );
						c.appendChild(newcircle);
					
					}
					else if(bit_gate2[x][j] == 3){
						
						

						var newpath = document.createElementNS("http://www.w3.org/2000/svg", 'path'); //Create a path in SVG's namespace
						var d = "M " + (350-w*gate_number/2+30+w*x) + " " + (50+j*h) +" L " + (350-w*gate_number/2+30+w*x) +" " + (50+j*h+8) ;
						newpath.setAttribute("d",d); //Set path's data
						newpath.style.stroke = "#000"; //Set stroke colour
						newpath.style.strokeWidth = "2px"; //Set stroke widthv
						c.appendChild(newpath);
						
						var newpath = document.createElementNS("http://www.w3.org/2000/svg", 'path'); //Create a path in SVG's namespace
						var d = "M " + (350-w*gate_number/2+30+w*x) + " " + (50+j*h-8) +" L " + (350-w*gate_number/2+30+w*x) +" " + (50+j*h) ;
						newpath.setAttribute("d",d); //Set path's data
						newpath.style.stroke = "#000"; //Set stroke colour
						newpath.style.strokeWidth = "2px"; //Set stroke widthv
						c.appendChild(newpath);
						
						var newcircle = document.createElementNS("http://www.w3.org/2000/svg", 'circle'); 
						newcircle.setAttributeNS(null, 'cx', 350-w*gate_number/2+30+w*x);
						newcircle.setAttributeNS(null, 'cy', 50+j*h);
						newcircle.setAttributeNS(null, 'r', 8);
						newcircle.setAttributeNS(null, 'style', 'fill:none; stroke: black; stroke-width: 2px;' );
						c.appendChild(newcircle);
					}
					
					
				}
			}
			
			
			
			
			/*var newpath = document.createElementNS("http://www.w3.org/2000/svg", 'path'); //Create a path in SVG's namespace
			newpath.setAttribute("d","M 100 100 L 160 100"); //Set path's data
			newpath.style.stroke = "#000"; //Set stroke colour
			newpath.style.strokeWidth = "2px"; //Set stroke widthv
			c.appendChild(newpath);*/
			
			
			
			
			
		}
	
		function reset(e){
			var c = document.getElementById("svg_diagram");
			c.innerHTML ="";
			
			document.getElementById("circuit").value="";
			document.getElementById("gate_count").innerHTML="Gate count ： ";
			document.getElementById("truth_table").value="";
		
		}
		
		
	</script>
</html>
